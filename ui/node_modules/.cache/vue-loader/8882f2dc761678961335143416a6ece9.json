{"remainingRequest":"C:\\Users\\mauro\\Desktop\\Sito\\ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\mauro\\Desktop\\Sito\\ui\\src\\components\\Ripetizioni.vue?vue&type=style&index=0&id=c8f316cc&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\mauro\\Desktop\\Sito\\ui\\src\\components\\Ripetizioni.vue","mtime":1638139842611},{"path":"C:\\Users\\mauro\\Desktop\\Sito\\ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1637017579926},{"path":"C:\\Users\\mauro\\Desktop\\Sito\\ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1637017581361},{"path":"C:\\Users\\mauro\\Desktop\\Sito\\ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1637017580498},{"path":"C:\\Users\\mauro\\Desktop\\Sito\\ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1637017579394},{"path":"C:\\Users\\mauro\\Desktop\\Sito\\ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1637017580772}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQoNCi5wcmV2ZW50Wm9vbSB7DQogIHRvdWNoLWFjdGlvbjogbWFuaXB1bGF0aW9uOw0KfQ0KDQo="},{"version":3,"sources":["Ripetizioni.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkbA;AACA;AACA","file":"Ripetizioni.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div>\r\n      <v-app>\r\n          <!-- header -->\r\n          <v-app-bar color=\"black\" dark app>\r\n              <v-icon class=\"mr-2\" x-large>mdi-book-open-page-variant</v-icon>\r\n              <v-app-bar-title class=\"text-h4 text-no-wrap pt-2\">Ripetizioni</v-app-bar-title>\r\n              <v-spacer></v-spacer>\r\n              <v-menu dark offset-y>\r\n                <template v-slot:activator=\"{on,attrs}\">\r\n                  <v-btn icon v-bind=\"attrs\" v-on=\"on\">\r\n                    <v-icon>mdi-dots-hexagon</v-icon>\r\n                  </v-btn>\r\n                </template>\r\n                <v-list>\r\n                  <v-list-item link dense @click=\"addPersona.visible=true\">\r\n                    <v-list-item-title>Aggiungi</v-list-item-title>\r\n                  </v-list-item>\r\n                </v-list>\r\n              </v-menu>\r\n          </v-app-bar>\r\n          <!-- main -->\r\n          <v-main class=\"ma-9\">\r\n            <v-row>\r\n              <v-col \r\n                v-for=\"ragazzo in ragazzi\"\r\n                :key=\"ragazzo.id\"\r\n                cols=12\r\n                md=auto\r\n              >\r\n                <v-card \r\n                  outlined color=\"amber darken-1 rounded-lg\"\r\n                  @click=\"openDialog('viewIncontri', ragazzo.nome, ragazzo.cognome, ragazzo.id)\"\r\n                >\r\n                  <v-card-title \r\n                    class=\"text-h5 font-weight-medium\"\r\n                  >\r\n                  {{ragazzo.nome}} {{ragazzo.cognome}}\r\n                  </v-card-title>\r\n                  <v-card-text>\r\n                    <v-chip class=\"mr-3\" color=\"red\" text-color=\"white\">\r\n                      <span v-if=\"conti.totaleDovuto[ragazzo.id]\">{{conti.totaleDovuto[ragazzo.id]}}</span>\r\n                      <span v-else>0</span>\r\n                    </v-chip>\r\n                    <v-chip color=\"green\" text-color=\"white\">\r\n                      <span v-if=\"conti.totaleSaldato[ragazzo.id]\">{{conti.totaleSaldato[ragazzo.id]}}</span>\r\n                      <span v-else>0</span>\r\n                    </v-chip>\r\n                  </v-card-text>\r\n                </v-card>\r\n              </v-col>\r\n            </v-row>\r\n            <!-- Aggiungi ragazzo -->\r\n            <v-dialog \r\n              v-model=\"addPersona.visible\"\r\n              transition=\"fab-transition\"\r\n              persistent\r\n            > \r\n              <v-card width=300px flat>\r\n                <v-card-title class=\"mb-3\">\r\n                  Aggiungi ragazzo\r\n                  <v-spacer></v-spacer>\r\n                  <v-btn icon @click=\"addPersona.visible=false\"><v-icon>mdi-close</v-icon></v-btn>\r\n                </v-card-title>\r\n                <v-card-text class=\"\">\r\n                    <v-form ref=\"addPersona\" @submit.prevent=\"submit('addPersona')\">\r\n                     <v-text-field\r\n                       label=\"Nome\"\r\n                       required\r\n                       outlined\r\n                       v-model=\"addPersona.body.nome\"\r\n                       :rules=\"addPersona.rules.nome\"\r\n                     ></v-text-field>\r\n                     <v-text-field\r\n                       label=\"Cognome\"\r\n                       required\r\n                       outlined\r\n                       v-model=\"addPersona.body.cognome\"\r\n                       :rules=\"addPersona.rules.cognome\"\r\n                     ></v-text-field>\r\n                     <v-text-field\r\n                       label=\"Indirizzo\"\r\n                       required\r\n                       outlined\r\n                       v-model=\"addPersona.body.indirizzo\"\r\n                       :rules=\"addPersona.rules.indirizzo\"\r\n                     ></v-text-field>\r\n                     <v-row class=\"mb-1\">\r\n                       <v-spacer></v-spacer>\r\n                       <v-btn \r\n                         class=\"mr-3 mt-3\"\r\n                         color=\"amber darken-1 rounded-lg\"\r\n                         type=\"submit\"\r\n                       >\r\n                         Aggiungi\r\n                       </v-btn>\r\n                     </v-row>\r\n                    </v-form>\r\n                </v-card-text>\r\n              </v-card>\r\n            </v-dialog>\r\n            <!-- Visualizza incontri ragazzo -->\r\n            <v-dialog\r\n              v-model=\"viewIncontri.visible\"\r\n              transition=\"fab-transition\"\r\n              persistent\r\n            >\r\n              <v-card flat>\r\n                <v-card-title>\r\n                  {{ viewIncontri.nomeRagazzo }}\r\n                  <v-spacer></v-spacer>\r\n                  <v-btn icon @click=\"viewIncontri.visible=false\"><v-icon>mdi-close</v-icon></v-btn>\r\n                </v-card-title>\r\n                <v-card-text>\r\n                    Totale ore:\r\n                    <v-chip color=\"amber darken-1\" class=\"mr-2\">\r\n                        {{ hourFormatter(totOreIncontri()) }}\r\n                    </v-chip>\r\n                    Totale: \r\n                    <v-chip color=\"amber darken-1\">\r\n                      {{ conti.totaleDovuto[viewIncontri.ragazzo]+conti.totaleSaldato[viewIncontri.ragazzo] }}â‚¬\r\n                    </v-chip>\r\n                  <v-data-table\r\n                    class=\"mt-1\"\r\n                    :headers=\"[\r\n                      {text: 'Data', value: 'data'},\r\n                      {text: 'Ore', value: 'ore'},\r\n                      {text: 'Ok', value: 'saldato', width: '17%'},\r\n                      {text: 'Materia', value: 'materia', width: '18%'}\r\n                    ]\"\r\n                    :items=\"viewIncontri.incontri\"\r\n                    calculate-widths\r\n                    sort-by=\"data\"\r\n                    sort-desc\r\n                    mobile-breakpoint=\"0\"\r\n                    @click:row=\"(e,i)=>openDialog('editIncontro',e,i)\"\r\n                    :footer-props=\"{\r\n                      itemsPerPageText: 'Righe per pagina',\r\n                      itemsPerPageAllText: 'Tutti',\r\n                      pageText: '',\r\n                      showCurrentPage: true,\r\n                      showFirstLastPage: true\r\n                    }\"\r\n                  >\r\n                    <!-- eslint-disable-next-line -->\r\n                    <template v-slot:item.data=\"{ item }\">\r\n                      {{ dataInverter(item.data) }}\r\n                    </template>\r\n                    <!-- eslint-disable-next-line -->\r\n                    <template v-slot:item.ore=\"{ item }\">\r\n                      {{ hourFormatter(item.ore) }}\r\n                    </template>\r\n                    <!-- eslint-disable-next-line -->\r\n                    <template v-slot:item.saldato=\"{ item }\">\r\n                      <v-simple-checkbox\r\n                        :value=\"item.saldato==0 ? false:true\"\r\n                        disabled\r\n                      >\r\n                    </v-simple-checkbox>\r\n                  </template>\r\n                  </v-data-table>\r\n                </v-card-text>\r\n              </v-card>\r\n            </v-dialog>\r\n            <!-- Modifica incontro -->\r\n            <v-dialog\r\n              v-model=\"editIncontro.visible\"\r\n              transition=\"fab-transition\"\r\n              \r\n            >\r\n              <v-card>\r\n                <v-card-title>Modifica incontro</v-card-title>\r\n                <v-card-text>\r\n                  <v-menu\r\n                    v-model=\"editIncontro.dateMenu\"\r\n                    offset-y\r\n                  >\r\n                    <template v-slot:activator=\"{on, attrs}\">\r\n                      <v-text-field\r\n                        label=\"Data\"\r\n                        :value=\"dataInverter(editIncontro.body.data)\"\r\n                        readonly\r\n                        v-bind=\"attrs\"\r\n                        v-on=\"on\"\r\n                      >\r\n                      </v-text-field>\r\n                    </template>\r\n                    <v-date-picker\r\n                      v-model=\"editIncontro.body.data\"\r\n                      @input=\"editIncontro.dateMenu = false\"\r\n                      no-title\r\n                      locale=\"IT\"\r\n                      color=\"#f08800\"\r\n                    >\r\n                    </v-date-picker>\r\n                  </v-menu>\r\n                  <v-row class=\"preventZoom pt-2\">\r\n                    <v-btn \r\n                      text \r\n                      fab \r\n                      small\r\n                      color=\"#d67900\"\r\n                      :disabled=\"editIncontro.body.ore<0.25\" \r\n                      class=\"mr-2 mt-1\" \r\n                      @click=\"editIncontro.body.ore-=0.25\"\r\n                    >\r\n                      <v-icon>mdi-minus-box</v-icon>\r\n                    </v-btn>\r\n                    <v-text-field\r\n                      label=\"Ore\"\r\n                      :value=\"hourFormatter(editIncontro.body.ore)\"\r\n                    >\r\n                    </v-text-field>\r\n                    <v-btn \r\n                      text \r\n                      fab \r\n                      small\r\n                      class=\"mr-2 mt-1\"\r\n                      color=\"#d67900\"\r\n                      @click=\"editIncontro.body.ore+=0.25\"\r\n                    >\r\n                      <v-icon text>mdi-plus-box</v-icon>\r\n                    </v-btn>\r\n                  </v-row>\r\n                  <v-row class=\"mt-0\">\r\n                    <v-col cols=\"8\">\r\n                      <v-select\r\n                        label=\"Materia\"\r\n                        :items=\"editIncontro.materie\"\r\n                        v-model=\"editIncontro.body.materia\"\r\n                      >\r\n                      </v-select>\r\n                    </v-col>\r\n                    <v-col cols=\"4\">\r\n                      <v-checkbox\r\n                        label=\"Ok\"\r\n                        v-model=\"editIncontro.body.saldato\"\r\n                      >\r\n                      </v-checkbox>\r\n                    </v-col>\r\n                  </v-row>\r\n                </v-card-text>\r\n              </v-card>\r\n            </v-dialog>\r\n          </v-main>\r\n      </v-app>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  name: 'HelloWorld',\r\n  data(){\r\n    return {\r\n      addPersona: {\r\n        visible: false,\r\n        validate: false,\r\n        body: {\r\n          nome:'',\r\n          cognome:'',\r\n          indirizzo:''\r\n        },\r\n        rules: {\r\n          nome:      [ x => !x==\"\" || \"Nome non valido\" ],\r\n          cognome:   [ x => !x==\"\" || \"Cognome non valido\" ],\r\n          indirizzo: [ x => /[A-z]*,[\\s\\S]*\\d/.test(x) || \"Indirizzo non valido (es. Milano, via Gino 3)\" ]\r\n        }\r\n      },\r\n      viewIncontri : {\r\n        visible: false,\r\n        ragazzo: 0,\r\n        nomeRagazzo: \"\",\r\n        incontri: []\r\n      },\r\n      editIncontro: {\r\n        visible: false,\r\n        dateMenu: false,\r\n        materie: [],\r\n        body: {}\r\n      },\r\n      ragazzi: [],\r\n      conti: {\r\n        totaleDovuto: {},\r\n        totaleSaldato: {},\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.selectFromDb('Ragazzo').then(res => this.setRagazzi(res));\r\n    this.getConti().then(res => this.setConti(res));\r\n  },\r\n  props: {},\r\n  methods: {\r\n    selectFromDb (table) {\r\n      return axios.post(\r\n        \"http://\"+this.$backendAddr+\":4000/selectDb\",\r\n        {'table': table}\r\n      ).then( function(response) {\r\n        return response.data\r\n      });\r\n    },\r\n\r\n    insertIntoDb (table, data, next) {\r\n      axios.post(\r\n        \"http://\"+this.$backendAddr+\":4000/insertDb\",\r\n        {\r\n          'table': table,\r\n          'data': data\r\n        }\r\n      ).then( function(res) {\r\n        //console.log(res);\r\n        next(res);\r\n      }).catch( function(err) {\r\n        console.log(err);\r\n        throw err;\r\n      });\r\n    },\r\n\r\n    setRagazzi (data) { this.ragazzi=data },\r\n    setConti (data) { this.conti=data },\r\n    setIncontri (data) { Promise.all(this.viewIncontri.incontri=data).then( res => this.viewIncontri.incontri=res )},\r\n     \r\n    // 2021-12-16 -> 16-12-2021\r\n    dataInverter (data) {\r\n      let x = data.split('-').reverse();\r\n      return x[0].concat('-', x[1], '-', x[2]);\r\n    },\r\n\r\n    hourFormatter (h) {\r\n      if (Number.isInteger(h)) { return `${h.toString()}h`}\r\n      else { \r\n        if (Number.isInteger(h-0.25)) { // e un quarto\r\n          return `${parseInt(h)}h 15'`\r\n        }  \r\n        if (Number.isInteger(h-0.5)) { // e mezza\r\n          return `${parseInt(h)}h 30'`\r\n        }\r\n        if (Number.isInteger(h-0.75)) { // e 45m\r\n          return `${parseInt(h)}h 45'`\r\n        }\r\n      }\r\n    },\r\n\r\n    getConti () {\r\n      return axios.post(\r\n        \"http://\"+this.$backendAddr+\":4000/query\",\r\n        {\r\n          'query': \"WITH saldati AS (SELECT T.ragazzo, SUM(I.ore*T.prezzo) as totSaldato FROM Incontro as I LEFT JOIN Tariffa as T ON T.id=I.tariffa WHERE I.saldato=1 GROUP BY T.ragazzo) SELECT T2.ragazzo, SUM(I2.ore*T2.prezzo) as totale, S2.totSaldato as totaleSaldato FROM Incontro AS I2 LEFT JOIN Tariffa as T2 ON T2.id=I2.tariffa LEFT JOIN saldati as S2 ON S2.ragazzo=T2.ragazzo GROUP BY T2.ragazzo;\"\r\n        }\r\n      ).then( function(res) {\r\n        let dictonary = {\r\n          'totaleSaldato': {},\r\n          'totaleDovuto': {}\r\n        };\r\n        for (let x in res.data) {\r\n          let key = res.data[x]['ragazzo']\r\n          dictonary['totaleSaldato'][key] = res.data[x]['totaleSaldato']\r\n          dictonary['totaleDovuto'][key] = res.data[x]['totale'] - res.data[x]['totaleSaldato']\r\n        }\r\n        return dictonary;\r\n      });\r\n    },\r\n\r\n    getIncontri (ragazzo) {\r\n      return axios.post(\r\n        \"http://\"+this.$backendAddr+\":4000/query\",\r\n        {'query': `SELECT I.id, I.data, T.materia, I.ore, I.saldato FROM Incontro AS I JOIN Tariffa AS T ON T.id=I.tariffa WHERE T.ragazzo=${ragazzo};`}\r\n      ).then( res => {\r\n        return res.data\r\n      } );\r\n    },\r\n\r\n    getMaterie (ragazzo) {\r\n      return axios.post(\r\n        \"http://\"+this.$backendAddr+\":4000/query\",\r\n        {'query': `SELECT materia FROM Tariffa WHERE ragazzo=${ragazzo};`}\r\n      ).then( res => {\r\n        let tot = [];\r\n        for (let i in res.data) {\r\n          tot.push(res.data[i].materia)\r\n        }\r\n        return tot;\r\n      }\r\n      );\r\n    },\r\n\r\n    totOreIncontri () {\r\n      let tot = 0;\r\n      for (let i in this.viewIncontri.incontri) {\r\n        tot += this.viewIncontri.incontri[i].ore\r\n      }\r\n      return tot;\r\n    },\r\n\r\n    openDialog (dialog, ...args) {\r\n      switch (dialog) {\r\n        case 'viewIncontri': //['viewIncontri', nome, cognome, id]\r\n          this.viewIncontri.visible=true, \r\n          this.viewIncontri.nomeRagazzo=args[0]+' '+args[1],\r\n          this.viewIncontri.ragazzo= args[2],\r\n          this.getIncontri(args[2]).then(res => this.viewIncontri.incontri=res)\r\n          break;\r\n        case 'editIncontro': //['editIncontro', event, item]\r\n          this.editIncontro.visible = true,\r\n          this.editIncontro.body = args[1].item\r\n          this.getMaterie(this.viewIncontri.ragazzo).then(res => this.editIncontro.materie=res)\r\n          break;\r\n      }\r\n    },\r\n\r\n    submit (ref) {\r\n      let self = this;\r\n      switch(ref){\r\n        case \"addPersona\":\r\n          if (this.$refs.addPersona.validate()) {\r\n            this.insertIntoDb('Ragazzo', this.addPersona.body, function(res) {\r\n              self.addPersona.visible = false;\r\n              self.ragazzi = res['data'];\r\n            })\r\n          } else {\r\n            console.log(\"Dati errati\")\r\n          }\r\n          break;\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n.preventZoom {\r\n  touch-action: manipulation;\r\n}\r\n\r\n</style>\r\n"]}]}